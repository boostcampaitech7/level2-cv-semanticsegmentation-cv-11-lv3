
# ğŸ† Hand Bone Semantic Segmentation

## ğŸ¥‡ íŒ€ êµ¬ì„±ì›

### ì´ìƒì§„, ìœ í¬ì„, ì •ì§€í›ˆ, ì²œìœ ë™, ì„ìš©ì„­,ë°•ì¬ìš°
## í”„ë¡œì íŠ¸ ì†Œê°œ
ë¼ˆëŠ” ìš°ë¦¬ ëª¸ì˜ êµ¬ì¡°ì™€ ê¸°ëŠ¥ì— ì¤‘ìš”í•œ ì˜í–¥ì„ ë¯¸ì¹˜ê¸° ë•Œë¬¸ì—, ì •í™•í•œ ë¼ˆ ë¶„í• ì€ ì˜ë£Œ ì§„ë‹¨ ë° ì¹˜ë£Œ ê³„íšì„ ê°œë°œí•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤.

Bone Segmentationì€ ì¸ê³µì§€ëŠ¥ ë¶„ì•¼ì—ì„œ ì¤‘ìš”í•œ ì‘ìš© ë¶„ì•¼ ì¤‘ í•˜ë‚˜ë¡œ, íŠ¹íˆ, ë”¥ëŸ¬ë‹ ê¸°ìˆ ì„ ì´ìš©í•œ ë¼ˆ Segmentationì€ ë§ì€ ì—°êµ¬ê°€ ì´ë£¨ì–´ì§€ê³  ìˆìœ¼ë©°, ë‹¤ì–‘í•œ ëª©ì ìœ¼ë¡œ ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í‰ê°€ì§€í‘œëŠ” Dice Coefficientì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

<br />

## ğŸ“… í”„ë¡œì íŠ¸ ì¼ì •
í”„ë¡œì íŠ¸ ì „ì²´ ì¼ì •

- 2024.10.28(ì›”) ~ 2024.11.7(ëª©)

<div align='center'>
    <img src='.\img\gantt.png', alt='ê°„íŠ¸ ì°¨íŠ¸'>
    <p><em>ê°„íŠ¸ ì°¨íŠ¸</em></p>
</div>

## ğŸ¤ í˜‘ì—… Tools
### í•™ìŠµ ì•Œë¦¼
#### Slack & KakaoTalk
- **í•™ìŠµ ì‹œì‘, ì™„ë£Œ, ì—ëŸ¬ ë°œìƒ** ì‹œ Slackê³¼ ì¹´ì¹´ì˜¤í†¡ì„ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì•Œë¦¼ì„ ì „ì†¡í•˜ì—¬ íŒ€ì›ë“¤ì´ ì¦‰ì‹œ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.
<div align='center'>
    <img src='.\img\slack.png', alt='slack í•™ìŠµ ì•Œë¦¼'>
    <p><em>Slack ì•Œë¦¼</em></p>
    <img src='.\img\kakaotalk.png', alt='ì¹´ì¹´ì˜¤í†¡ í•™ìŠµ ì•Œë¦¼'>
    <p><em>ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼</em></p>
</div>

#### Google Sheet
- ì„œë²„ ì‚¬ìš© í˜„í™© í™•ì¸ ë° í•™ìŠµ ì™„ë£Œ ì‹œ í•™ìŠµê²°ê³¼ë¥¼ ìë™ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
<div align='center'>
    <img src='.\img\spreadsheet_server.png', alt='ì„œë²„ ì‚¬ìš© í˜„í™©'>
    <p><em>Google Sheet ì„œë²„ ì‚¬ìš© í˜„í™©</em></p>
    <img src='.\img\spreadsheet_result.png', alt='í•™ìŠµ ê²°ê³¼ ì €ì¥'>
    <p><em>í•™ìŠµ ê²°ê³¼ ìë™ ì €ì¥</em></p>
</div>

### í”„ë¡œì íŠ¸ ê´€ë¦¬
#### ML Flow
<div align='center'>
    <img src='.\img\mlflow.png', alt='ì„œë²„ ì‚¬ìš© í˜„í™©'>
    <p><em>ML Flow</em></p>
</div>

- ML FLowë¥¼ í™œìš©í•´ ì‹¤í—˜ ê¸°ë¡ì„ ì¶”ì í•˜ì˜€ìŠµë‹ˆë‹¤.

#### Notion
- í”„ë¡œì íŠ¸ ê´€ë¦¬ ë° ì‘ì—… ëª©ë¡, íšŒì˜ ê¸°ë¡ì„ ê³µìœ í•©ë‹ˆë‹¤.
#### Zoom
- ì£¼ê¸°ì ì¸ íšŒì˜ì™€ ì‹¤ì‹œê°„ í”¼ë“œë°± ì œê³µì„ ìœ„í•´ ì¤Œì„ ì‚¬ìš©í•´ ì†Œí†µí•˜ì˜€ìŠµë‹ˆë‹¤.
#### GitHub
- ì½”ë“œ ë²„ì „ ê´€ë¦¬ ë° í˜‘ì—…ì„ ìœ„í•´ GitHubë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

<br />


## ğŸ¥ˆ í”„ë¡œì íŠ¸ ê²°ê³¼
### Public
- **4** / 24
- Dice Coeff : **0.9200**
### Private
- **5** / 24
- Dice Coeff : **0.9073**

<br />

## ğŸ¥‰ ë°ì´í„°ì…‹ êµ¬ì¡°
```
dataset
     â”œâ”€test
     â”‚    â””â”€DCM
     â”‚         â”œâ”€ID040
     â”‚         â”‚     *.png
     â”‚         â””â”€ID041
     â”‚               *.png
     â”œâ”€train
     â”‚    â”œâ”€DCM
     â”‚    â”‚   â”œâ”€ID001
     â”‚    â”‚   â”‚     *.png
     â”‚    â”‚   â””â”€ID002
     â”‚    â”‚         *.png
     â”‚    â”‚        
     â”‚    â””â”€outputs_json
     â”‚               â”œâ”€ID001
     â”‚               â”‚     *.json
     â”‚               â””â”€ID002
                           *.json
```

<div align='center'>
    <img src='.\img\classes.png', alt='í´ë˜ìŠ¤'>
    <p><em>Hand Bone Classes</em></p>
</div>

ì´ ì½”ë“œëŠ” `ë¶€ìŠ¤íŠ¸ìº í”„ AI Tech`ì—ì„œ ì œê³µí•˜ëŠ” ë°ì´í„°ì…‹ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„±ì„ ë”°ë¦…ë‹ˆë‹¤. 
- ì „ì²´ ì´ë¯¸ì§€ ê°œìˆ˜ : 1088ì¥
- ë¶„ë¥˜ í´ë˜ìŠ¤ : 29ê°œì˜ í´ë˜ìŠ¤
- ì „ì²´ ë°ì´í„° ì¤‘ í•™ìŠµë°ì´í„° 800ì¥, í‰ê°€ë°ì´í„° 288ì¥ìœ¼ë¡œ ì‚¬ìš©
- ì œì¶œ í˜•ì‹ : Run-Length Encoding(RLE)í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ CSV íŒŒì¼ë¡œ ì œì¶œ

<br />

## ğŸ¥‰ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
project/pytorch
     â”œâ”€ checkpoints
     â”œâ”€ configs
     â”‚    â””â”€ base_train.yaml
     â”‚
     â”œâ”€ data
     â”‚    â”œâ”€ test_dataset.py
     â”‚    â””â”€ train_dataset.py
     â”‚
     â”œâ”€ loss
     â”œâ”€ models
     â”œâ”€ scheduler
     â”‚    â”œâ”€ CustomCAWR
     â”‚    â””â”€ scheduler_selector.py
     â”‚
     â”œâ”€ services
     â”‚    â”œâ”€ kakao.py
     â”‚    â”œâ”€ refresh_kakao_token.py
     â”‚    â”œâ”€ sheet_kakao_key_update.py
     â”‚    â”œâ”€ sheet_pull_kakao_key.py
     â”‚    â”œâ”€ slack.py
     â”‚    â””â”€ spreadsheet.py
     â”‚
     â”œâ”€ trainer
     â”‚    â”œâ”€ Earlystopping.py
     â”‚    â”œâ”€ test.py
     â”‚    â”œâ”€ test_rle.py
     â”‚    â”œâ”€ trainer.py
     â”‚    â””â”€ visualize.py
     â”‚
     â”œâ”€ transform
     â”‚    â””â”€ transform.py
     â”‚
     â”œâ”€ utils
     â”‚    â”œâ”€ mlflow.py
     â”‚    â””â”€ util.py
     â”‚
     â”œâ”€ K-fold_ensemble.py
     â”œâ”€ inference.py
     â”œâ”€ main.py
     â”œâ”€ requirements.txt
     â””â”€ train.py
    
```
### 1) Services
- `kakao.py`: ì¹´ì¹´ì˜¤í†¡ ë©”ì„¸ì§€ ì „ì†¡, uuid ì¶”ì¶œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- `refresh_kakao_token.py`: ì¹´ì¹´ì˜¤ ë¦¬í”„ë ˆì‹œ í† í°ì„ ì´ìš©í•´ ì¹´ì¹´ì˜¤í†¡ ì•¡ì„¸ìŠ¤ í† í°ì„ ê°±ì‹ í•©ë‹ˆë‹¤. (crontab 8ì‹œê°„ ë§ˆë‹¤ ì‹¤í–‰)
- `sheet_kakao_key_update.py`: ê°±ì‹ ëœ ì¹´ì¹´ì˜¤í†¡ ì•¡ì„¸ìŠ¤ í† í°ì„ Google Sheetì— ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. (crontab 30ì´ˆë§ˆë‹¤ ì‹¤í–‰)
- `sheet_pull_kakao_key.py`: Google Sheetì—ì„œ ìµœì‹  ì¹´ì¹´ì˜¤í†¡ ì•¡ì„¸ìŠ¤ í† í°ì„ ê°€ì ¸ì™€ ë¡œì»¬ í™˜ê²½ì— ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤. (crontab 30ì´ˆë§ˆë‹¤ ì‹¤í–‰)
- `slack.py`: í•™ìŠµí˜„í™©ì„ ìŠ¬ë™ ë©”ì‹œì§€ë¡œ ì „ì†¡í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- `spreadsheet.py`: ì„œë²„ í•™ìŠµ í˜„í™© ë° í•™ìŠµ ë°ì´í„°ë¥¼ Google Sheetì— ì—…ë°ì´íŠ¸, ì¶”ê°€í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
  
### 2) tools
- `cloba2datu.ipynb`: cord ë°ì´í„°ì…‹ì„ datumaro í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
- `datu2ufo.ipynb`: datumaro í˜•ì‹ì˜ ë°ì´í„°ì…‹ì„ UFO í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
- `ufo2datu.ipynb`: UFO í˜•ì‹ì˜ ë°ì´í„°ì…‹ì„ datumaro í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
- `easyocr_pseudo.ipynb`: Easyocr ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•´ì„œ pseudo-labelingì„ ì§„í–‰í•©ë‹ˆë‹¤.
- `img_hash.ipynb`: ì´ë¯¸ì§€ hashê°’ì„ ì´ìš©í•´ ì¤‘ë³µ ì´ë¯¸ì§€ë¥¼ ì œê±°í•˜ê³  200ì¥ì˜ ì´ë¯¸ì§€ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
- `inference_visualize.ipynb`: inferenceí•œ ê²°ê³¼ë¥¼ testì´ë¯¸ì§€ì— ì‹œê°í™”í•©ë‹ˆë‹¤.
- `server-status.py`: ì„œë²„ì˜ CPU, ë©”ëª¨ë¦¬, GPU ìƒíƒœë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
- `data_duplication_check.py`: hashê°’ìœ¼ë¡œ ì´ë¯¸ì§€ê°€ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì œê±°í•©ë‹ˆë‹¤.
- `streamlit_viz.py`: datasetì˜ annotationì„ streamlitìœ¼ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.

<br />

## âš™ï¸ ì„¤ì¹˜

### Dependencies
ì´ ëª¨ë¸ì€ Tesla v100 32GBì˜ í™˜ê²½ì—ì„œ ì‘ì„± ë° í…ŒìŠ¤íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤.
ë˜ ëª¨ë¸ ì‹¤í–‰ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

```bash
pip install -r requirements.txt
```
<details>
<summary>requirements ì ‘ê¸°/í¼ì¹˜ê¸°</summary>

- lanms==1.0.2
- opencv-python==4.10.0.84
- shapely==2.0.5
- albumentations==1.4.12
- torch==2.1.0
- tqdm==4.66.5
- albucore==0.0.13
- annotated-types==0.7.0
- contourpy==1.1.1
- cycler==0.12.1
- eval_type_backport==0.2.0
- filelock==3.15.4
- fonttools==4.53.1
- fsspec==2024.6.1
- imageio==2.35.0
- importlib_resources==6.4.2
- Jinja2==3.1.4
- kiwisolver==1.4.5
- lazy_loader==0.4
- MarkupSafe==2.1.5
- matplotlib==3.7.5
- mpmath==1.3.0
- networkx==3.1
- numpy==1.24.4
- nvidia-cublas-cu12==12.1.3.1
- nvidia-cuda-cupti-cu12==12.1.105
- nvidia-cuda-nvrtc-cu12==12.1.105
- nvidia-cuda-runtime-cu12==12.1.105
- nvidia-cudnn-cu12==8.9.2.26
- nvidia-cufft-cu12==11.0.2.54
- nvidia-curand-cu12==10.3.2.106
- nvidia-cusolver-cu12==11.4.5.107
- nvidia-cusparse-cu12==12.1.0.106
- nvidia-nccl-cu12==2.18.1
- nvidia-nvjitlink-cu12==12.6.20
- nvidia-nvtx-cu12==12.1.105
- packaging==24.1
- pillow==10.4.0
- pydantic==2.8.2
- pydantic_core==2.20.1
- pyparsing==3.1.2
- python-dateutil==2.9.0.post0
- PyWavelets==1.4.1
- PyYAML==6.0.2
- scikit-image==0.21.0
- scipy==1.10.1
- six==1.16.0
- sympy==1.13.2
- tifffile==2023.7.10
- tomli==2.0.1
- triton==2.1.0
- typing_extensions==4.12.2
</details>
<br />

## ğŸš€ ë¹ ë¥¸ ì‹œì‘
### Train
```python
python custom_train.py 
```
### Train Parser
ê¸°ë³¸ ì„¤ì •
- `--data_dir` : Dataset directory
- `--model_dir` : Model directory (ê¸°ë³¸ê°’ : EAST Model)
- `--device` : `cuda` or `cpu` ( ê¸°ë³¸ê°’ : cuda )

í•™ìŠµ ì„¤ì •
- `--num_workers` : í•™ìŠµí•  í”„ë¡œì„¸ìŠ¤ ìˆ˜ (ê¸°ë³¸ê°’ : 8)
- `--image_size` : í•™ìŠµí•  ì´ë¯¸ì§€ í¬ê¸° (ê¸°ë³¸ê°’ : 2048)
- `--input_size` : í•™ìŠµí•  ì…ë ¥ ì´ë¯¸ì§€ í¬ (ê¸°ë³¸ê°’ : 1024)
- `--batch_size` : ë°°ì¹˜ í¬ê¸° ê²°ì • ( ê¸°ë³¸ê°’ : 8)
- `--learning_rate` : í•™ìŠµë¥  ì„¤ì • ( ê¸°ë³¸ê°’ : 0.001)
- `--max_epochs` : í•™ìŠµí•  ì—í­ ìˆ˜ (ê¸°ë³¸ê°’ : 150)
- `--save_interval` : ê°€ì¤‘ì¹˜ë¥¼ ì €ì¥í•  epoch ê°„ê²© (ê¸°ë³¸ê°’ : 5)

## ğŸ… Wrap-Up Report   
### [ Wrap-Up Report ğŸ‘‘]
